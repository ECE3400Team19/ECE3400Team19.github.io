<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
.w3-bar,h1,button {font-family: "Montserrat", sans-serif}
.fa-anchor,.fa-coffee {font-size:200px}
</style>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-red w3-card w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-red" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="https://ece3400team19.github.io" class="w3-bar-item w3-button w3-padding-large w3-hover-white">Home</a>
    <a href= "Contract.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Contract</a>
    <a href="Lab1.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Lab 1</a>
    <a href="Milestone1.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Milestone 1</a>
    <a href="Lab2.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Lab 2</a>
    <a href="Milestone2.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Milestone 2</a>
    <a href="Lab3.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Lab 3</a>
    <a href="Lab4.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Lab 4</a>
    <a href="Milestone3.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Milestone 3</a>
    <a href="Milestone4.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Milestone 4</a>
    <a href="Ethics_Homework.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-white">Ethics Homework</a>
    <a href="FinalDesign.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-white">Final Design</a>
    <a href="Photoshoot.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-white">Photoshoot!</a>
  </div>

  <!-- Navbar on small screens -->
  <!-- <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
    <a href="#" class="w3-bar-item w3-button w3-padding-large">Contract</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">Milestone 2</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">Link 3</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">Link 4</a>
  </div> -->
</div>

<!-- Header -->
<header class="w3-container w3-red w3-center" style="padding:128px 16px">
  <h1 class="w3-margin w3-jumbo">Milestone 1</h1>
  <p class="w3-xlarge">ECE 3400 Fall 2018: Team 19</p>
</header>

<!-- First Grid -->
<div class="w3-row-padding w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-twothird">
      


      <h1 id="milestone1followingaline">Milestone 1: Following a Line</h1>

<p><a href="https://ece3400team19.github.io/">Home</a></p>

<h2 id="teamtasks">Team Tasks</h2>

<ul>
<li>Asena, Cynthia, Laasya: code implementation for line following and figure eight, lab writeup parts 2 and 3</li>

<li>Nonso, Robert: line sensor hookup, robot assembly, code debugging, lab writeup for part 1</li>
</ul>

<h2 id="milestonedescription">Milestone Description</h2>

<p>The goal of this milestone was to get our robot to follow a line and traverse a grid in a figure eight</p>

<h2 id="milestonematerials">Milestone Materials</h2>

<p>3 line sensors (QRE1113)</p>

<h2 id="part1hookingupthelinesensors">Part 1 - Hooking up the Line Sensors</h2>

<p>There were two tasks included in milestone 1; following a line and driving in a figure eight.  Implicit in the second is the ability to turn either left or right.  To accomplish these tasks, we started with three line sensors.  They were mounted at the bottom of straight vertical pieces attached to the main chassis such that the sensors were as close to the ground as possible without dragging along the floor.  This proximity was necessary to get the most contrast we could between white and black.  </p>

<p><img src="Robot.jpeg" width="350" height="275" alt="banner" img align="right">
At first we had all three sensors facing parallel to the line side-by-side to use multiple low outputs (multiple sensors 'on the line') to aid in following the line.  However, we later settled on a method using a single sensor low to do line following, using the other two sensors only for course correction and detecting intersections.  To go along with this alternate implementation, we flared out the two sensors on the sides, aligning them away from the central sensor such that the distance between them was roughly equal to the width of the line for easy course correction.  </p>

<p>As we moved to the figure eight task, we decided to remount the sensors, putting them on the opposite side of the robot.  We kept the flared design from before for this remounting as well.  The final sensor position is shown to the right.</p>

<h2 id="part2followingaline">Part 2 - Following a Line</h2>

<p>Once we completed the setup for the Line Sensors, we developed an algorithm to best help the robot find the white line, stay on it, and turn right or left at the perpendicular intersections. The pseudo-code for this is as follows:   </p>

<p>Loop:
  If the middle line sensor detects a white line:
    the robot should go straight</p>

<p>If the middle sensor does not detect the white line, but the right sensor does:
    the robot should turn clockwise until the middle line sensor returns to the line</p>

<p>If the middle sensor does not detect the white line, but the left sensor does:
    the robot should turn counterclockwise until the middle line sensor returns to the line</p>

<p>If all 3 line sensors detect a white line:
    the robot acknowledges that it's at an intersection
    the robot will either turn left or right (to be determined by the code implementer)</p>

<p>Else:
    the robot should go straight until the middle sensor detects a line</p>

<p>This allowed the robot to find and remain on a line, even if it's starting position was not perfectly parallel with any of the white lines. The Arduino implementation of this code is provided below:</p>

<pre><code>#include &lt;Servo.h&gt;

Servo left; //180 turns wheel backward
Servo right; //180 turns wheel forward

int leftPin = A0; //define left line sensor's pin
int middlePin = A5; //define middle line sensor's pin
int rightPin = A1; //define right line sensor's pin
int leftSensor; //stores left line sensor's value
int middleSensor; //stores middle line sensor's value
int rightSensor; //stores right line sensor's value
int leftSpeed; //stores value of left servo
int rightSpeed; //stores value of right servo
int numIntersections = 0; //counts number of turns completed


void setup() {
  Serial.begin(9600);
  //left servo is connected to digital pin 10
  left.attach(10);
  //right servo is connected to digital pin 5
  right.attach(5);
}

void loop() {
  //read line sensor values
  leftSensor = analogRead(leftPin);
  middleSensor = analogRead(middlePin);
  rightSensor = analogRead(rightPin);

  //all sensors are on the white line
  if (leftSensor &lt; 800  &amp;&amp; middleSensor &lt; 800 &amp;&amp; rightSensor &lt; 800) {
    // AT AN INTERSECTION
    leftSpeed = 85;
    rightSpeed = 85;
    left.write(leftSpeed);
    right.write(rightSpeed);
    delay(400);
  }
  //middle sensor is on the white line
  else if (middleSensor &lt; 800) {
    //GO STRAIGHT
    leftSpeed = 95;
    rightSpeed = 85;
    left.write(leftSpeed);
    right.write(rightSpeed);
  }
  //middle sensor is not on the white line
  //adjust to get robot moving straight on the line again
  else {
    //robot has veered to the right
    //left sensor is only on the white line
    if (leftSensor &lt; 800){
      //TURN LEFT
      leftSpeed = 85;
      rightSpeed = 85;
    }
    //robot has veered to the left
    //right sensor is only on the white line
    if (rightSensor &lt; 800){
      //TURN RIGHT
      leftSpeed = 95;
      rightSpeed = 95;
    }
    left.write(leftSpeed);
    right.write(rightSpeed);
  }
}
</code></pre>

<h2 id="part3movinginafigureeight">Part 3 - Moving in a Figure Eight</h2>

<p>The next part of the lab was traversing a grid in a figure eight. In the video below, you can see our robot traversing the grid in repeated figure eights.</p>

 <iframe width="560" height="315" src="https://www.youtube.com/embed/7-ruKoju54E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<p>In order to move the robot in a figure eight, we took our line following code from above, and added a counter called numIntersections that is initialized to 0. When the robot reaches an intersection (all 3 line sensors see white), the robot turns left or right depending on the value of numIntersections. If numIntersections is less than 4, the robot will turn right. If numIntersections is greater than or equal to 4, the robot will turn left. Once numIntersections reaches 8, it will reset to 0. This way, the robot will make 4 right turns, then 4 left, then 4 right, then 4 left, and so on.
 In between the Line Following portion of the lab and the Moving in a Figure Eight, we changed the line sensors from the back of the robot to the front. The line sensors were closer to the wheels so we changed the way we turned the robot as well, after detecting the intersection, the robot moves forward slightly (for .2 seconds) then begins its turn. We decided on this method after the old method of turning would sometimes overshoot or undershoot the line.
 The Arduino code:</p>

<pre><code>#include &lt;Servo.h&gt;

Servo left; //180 turns wheel backward
Servo right; //180 turns wheel forward

int leftPin = A0; //define left line sensor's pin
int middlePin = A5; //define middle line sensor's pin
int rightPin = A1; //define right line sensor's pin
int leftSensor; //stores left line sensor's value
int middleSensor; //stores middle line sensor's value
int rightSensor; //stores right line sensor's value
int leftSpeed; //stores value of left servo
int rightSpeed; //stores value of right servo
int numIntersections = 0; //counts number of turns completed


void setup() {
  Serial.begin(9600);
  //left servo is connected to digital pin 10
  left.attach(10);
  //right servo is connected to digital pin 5
  right.attach(5);
}

//code within void loop() was modified
//to make robot move in a figure 8 shape
void loop() {
  //read line sensor values
  leftSensor = analogRead(leftPin);
  middleSensor = analogRead(middlePin);
  rightSensor = analogRead(rightPin);

  //all sensors are on the white line
  if (leftSensor &lt; 800 &amp;&amp; middleSensor &lt; 800 &amp;&amp; rightSensor &lt; 800){
    //AT AN INTERSECTION
    //reset count of turns made if figure 8 was executed
    if (numIntersections == 8) {numIntersections = 0;}
    //executed all right turns in figure 8, now turns left
    if (numIntersections &gt; 3) {
      //TURN LEFT
      leftSpeed = 85;
      rightSpeed = 85;
    }
    //executes right turns in figure 8
    else {
      //TURN RIGHT
      leftSpeed = 95;
      rightSpeed = 95;
    }
    ++numIntersections; //increment count of turns made
    //robot goes straight for 2 ms before starting to turn
    left.write(95);
    right.write(85);
    delay(200);
    //executes turn
    left.write(leftSpeed);
    right.write(rightSpeed);
    delay(700);
  }
  //middle sensor is on the white line
  else if ( middleSensor &lt; 800) {
    //GO STRAIGHT
    leftSpeed = 95;
    rightSpeed = 85;
    left.write(leftSpeed);
    right.write(rightSpeed);
  }
  //middle sensor is not on the white line
  //adjust to get robot moving straight on the line again
  else {
    //robot has veered to the right
    //left sensor is only on the white line
    if (leftSensor &lt; 800) {
      //TURN LEFT
      leftSpeed = 85;
      rightSpeed = 85;
    }
    //robot has veered to the left
    //right sensor is only on the white line
    if (rightSensor &lt; 800) {
      //TURN RIGHT
      leftSpeed = 95;
      rightSpeed = 95;
    }
    left.write(leftSpeed);
    right.write(rightSpeed);
  }
}
</code></pre>
    </div>

    <div class="w3-third w3-center">
      <i class="fa fa-anchor w3-padding-64 w3-text-red"></i>
    </div>
  </div>
</div>

<!-- Second Grid -->
<div class="w3-row-padding w3-light-grey w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-third w3-center">
      <i class="fa fa-coffee w3-padding-64 w3-text-red w3-margin-right"></i>
    </div>
  

  </div>
</div>



<!-- Footer -->
<footer class="w3-container w3-padding-64 w3-center w3-opacity">
  <div class="w3-xlarge w3-padding-32">
    <i class="fa fa-facebook-official w3-hover-opacity"></i>
    <i class="fa fa-instagram w3-hover-opacity"></i>
    <i class="fa fa-snapchat w3-hover-opacity"></i>
    <i class="fa fa-pinterest-p w3-hover-opacity"></i>
    <i class="fa fa-twitter w3-hover-opacity"></i>
    <i class="fa fa-linkedin w3-hover-opacity"></i>
 </div>
 <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
</footer>

<script>
// Used to toggle the menu on small screens when clicking on the menu button
function myFunction() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>

</body>
</html>
